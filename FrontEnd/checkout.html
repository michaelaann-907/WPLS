<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="script.js"></script>

    <style>
        #patronID {
            width: 300px; /* Adjust the width as needed */
            appearance: none;
            -webkit-appearance: none;
            padding: 8px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            color: black; /* Set text color to black or a contrasting color */
        }


        #patronID option {
            padding: 8px;
        }

        #patronID:focus {
            position: relative;
            z-index: 1;
        }
        #itemID {
            width: 300px; /* Adjust the width as needed */
            appearance: none;
            -webkit-appearance: none;
            padding: 8px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            color: black; /* Set text color to black or a contrasting color */
        }


        #itemID option {
            padding: 8px;
        }

        #itemID:focus {
            position: relative;
            z-index: 1;
        }
    </style>


    <title>Wayback Public Library - Library Check Out</title>
</head>
<body>
<header>
    <h1>Welcome to Wayback Public Library</h1>
    <p>Your Gateway to Knowledge</p>
</header>
<nav>
    <ul>
        <li><a href="home.html">Home</a></li>
        <li><a href="catalog.html">Catalog</a></li>
        <li><a href="checkin.html">Check In</a></li>
        <li><a href="checkout.html">Check Out</a></li>
    </ul>
</nav>
<main>
    <h1>Library Checkout</h1>
    <form id="checkoutForm" action="checkout.php" method="post">
        <label for="itemID">Item ID:</label>
        <select id="itemID" name="itemID" required onchange="updateDueDate()">
            <!-- Options will be dynamically populated using JavaScript -->
        </select>
        <br><br>

        <!-- Patron ID Dropdown -->
        <label for="patronID">Patron ID:</label>
        <select id="patronID" name="patronID" required>
            <!-- Options will be dynamically populated using JavaScript -->
        </select>
        <br><br>

        <label for="checkoutDate">Check Out Date:</label>
        <input type="date" id="checkoutDate" name="checkoutDate" required>
        <br><br>

        <label for="dueDate">Due Date:</label>
        <input type="date" id="dueDate" name="dueDate" required>
        <br><br>

        <input type="submit" value="Check Out">
    </form>

    <button class="custom-outbutton" id="printReceipt">Print Receipt</button>
</main>
<footer class="site-footer">
    <p>&copy; 2023 Wayback Public Library</p>
</footer>

<script>
    // Set the default check-out date as today based on the system's time zone
    document.addEventListener('DOMContentLoaded', function () {
        const checkoutDateInput = document.getElementById('checkoutDate');
        const today = new Date();
        
        // Adjust the date to match the local date in the system's time zone
        today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
        
        const formattedDate = today.toISOString().split('T')[0];
        checkoutDateInput.value = formattedDate;
    });
    
    function updateDueDate() {
        // Get the selected item's ID
        var itemID = document.getElementById('itemID').value;

        // Make an AJAX request to retrieve the duration for the selected item
        $.ajax({
            type: 'POST',
            url: 'getDuration.php', // Create a new PHP file to handle this request
            data: { itemID: itemID },
            success: function (response) {
                // Parse the response JSON
                var duration = JSON.parse(response).duration;

                // Calculate the due date based on the checkout date
                var checkoutDate = new Date(document.getElementById('checkoutDate').value);
                checkoutDate.setDate(checkoutDate.getDate() + duration);

                // Format the due date as 'YYYY-MM-DD'
                var formattedDueDate = checkoutDate.toISOString().split('T')[0];

                // Set the calculated due date to the 'dueDate' input field
                document.getElementById('dueDate').value = formattedDueDate;
            },
            error: function () {
                console.error('Error fetching duration for item ID ' + itemID);
            }
        });
    }
</script>

</body>
</html>
